import{R as w,r as j,h as W,g as z,s as V,d as Z,j as e,I as d,u as H,e as ee,a as ne,c as y,S as $,f as M,b as se}from"./index-CMoc7ZR7.js";import{u as Y,L as te,g as G,E as B,D as ae}from"./constants-B5zRJSNm.js";import{a as ie,u as Q,R as ce}from"./Rating-CJdtJZGK.js";import{B as v}from"./Button-Jr4WYPXk.js";import{u as oe,S as re}from"./Spacer-DbnJw1gm.js";import{P as le}from"./ProblemItem-Bure1T-F.js";import{T as g,I as me,P as ue}from"./PlaceCard-DexUxSBw.js";function X(n){n===void 0&&(n=w);var s=n===w?ie:function(){return j.useContext(n)};return function(){var a=s(),l=a.store;return l}}var de=X();function he(n){n===void 0&&(n=w);var s=n===w?de:X(n);return function(){var a=s();return a.dispatch}}var je=he();const xe=({id:n})=>W.request.get(`/place/${n}`),fe="PLACE",ge=({id:n})=>{const s=je(),t={item:z()},{data:a=t,...l}=Y([fe,"single",n],async()=>{const{data:r}=await xe({id:n});return{item:z(r)}},{initialData:t,enabled:!!n,onSuccess:r=>{s(V(r.item))},onError:()=>{s(Z())}});return{...l,...a}},I=({icon:n,description:s})=>e.jsxs("div",{className:"c-empty",children:[e.jsx("div",{children:e.jsx(d,{name:n})}),e.jsx("p",{className:"c-empty__description",children:s})]}),_e=()=>{const{images:n}=Q(s=>s.place.item);return e.jsx("div",{className:"image",children:n!=null&&n.length?e.jsx("div",{className:"image__list",children:n==null?void 0:n.map(s=>e.jsx("div",{className:"image__item",children:e.jsx("img",{src:s.image,alt:"",width:126,height:126})},s.id))}):e.jsx(I,{icon:"NoImage",description:"Hozircha rasmlar yo'q"})})},ve=()=>{const n=H(),s=Q(a=>a.place.item),t=j.useMemo(()=>[{title:"Joy ma’lumotlari",items:[{icon:"Location",iconColor:"#007AFF",key:"Manzil",value:s.fullAddress,onClick:()=>{}},{icon:"Car",iconColor:"#FF9500",key:"Manzilgacha Yandex-taxi",value:"4km • 15-20 min • 20,000 so’m",onClick:()=>{}},{icon:"Phone",iconColor:"#007AFF",key:"Aloqa raqami",value:s.phone,onClick:()=>{}},{icon:"Phone",iconColor:"#007AFF",key:"Qo’shimcha aloqa raqami",value:s.phone2,onClick:()=>{}},{icon:"Network",iconColor:"#34C759",key:"Web sayti",value:s.website,onClick:()=>{}}]},{title:"Ishlash vaqtlari va qulayliklar",items:[{icon:"Clock",iconColor:"#007AFF",key:"Ishlash vaqtlari",value:`Ochiq • ${s.workStartTime} - ${s.workEndTime}`,onClick:()=>n("/place/work-times")},{icon:"PuzzlePiece",iconColor:"#FF9500",key:"Qulayliklar",value:"Wi-fi • Karta orqali to’lash • Halol",onClick:()=>n("/place/amenities")}]}],[s]);return e.jsxs("div",{className:"general",children:[t.map((a,l)=>e.jsxs("div",{className:"general__item-group",children:[e.jsx(g,{text:a.title}),e.jsx("div",{className:"general__items",children:a.items.map(r=>e.jsx(me,{className:"general__item",left:e.jsx("div",{className:"general__item-icon",style:{backgroundColor:r.iconColor},children:e.jsx(d,{name:r.icon,color:"#ffffff",size:28})}),center:e.jsxs("div",{className:"general__item-info",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"general__item-key",children:r.key}),e.jsx("span",{className:"general__item-value",children:r.value})]}),e.jsx("div",{children:e.jsx(d,{name:"ChevronRight",color:"#7F7F7F",size:24})})]}),onClick:r.onClick},r.key))})]},l)),e.jsxs("div",{className:"general__item-group",children:[e.jsx(g,{text:"Ijtimoiy tarmoqlarga havola"}),e.jsxs("div",{className:"general__networks",children:[s.instagram&&e.jsx("a",{href:s.instagram,target:"_blank",rel:"noreferrer",children:e.jsx(d,{name:"Instagram",size:48})}),s.twitter&&e.jsx("a",{href:s.twitter,target:"_blank",rel:"noreferrer",children:e.jsx(d,{name:"Twitter",size:48})}),s.youtube&&e.jsx("a",{href:s.youtube,target:"_blank",rel:"noreferrer",children:e.jsx(d,{name:"Youtube",size:48})}),s.telegram&&e.jsx("a",{href:s.telegram,target:"_blank",rel:"noreferrer",children:e.jsx(d,{name:"Telegram",size:48})}),s.facebook&&e.jsx("a",{href:s.facebook,target:"_blank",rel:"noreferrer",children:e.jsx(d,{name:"Facebook",size:48})})]})]}),e.jsxs("div",{className:"general__item-group",children:[e.jsx(g,{text:"Joy xaqida"}),e.jsx("div",{className:"general__info",children:e.jsx("p",{className:"general__info-text",dangerouslySetInnerHTML:{__html:s.info}})})]}),e.jsxs("div",{className:"general__item-group",children:[e.jsx(g,{text:"Biz bilan aloqa"}),e.jsx(le,{})]})]})},pe=({placeId:n})=>{const s={items:[]},{data:t=s,...a}=Y([B,"list",n],async()=>{const{data:l}=await te({placeId:n});return{items:(ee(l,"results")||[]).map(G)}},{initialData:s,keepPreviousData:!0,enabled:!!n});return{...t,...a}},be=()=>{const n=ne();return oe(async({id:s})=>{const{data:t}=await ae({id:s});return G(t)},{onSuccess:()=>{n.invalidateQueries({predicate:s=>s.queryKey[0]===B&&s.queryKey[1]==="list"})}})},Ne=({isOpen:n,children:s})=>e.jsx("div",{className:y("c-modal",n&&"open"),children:e.jsx("div",{className:"c-modal__content",children:!!s&&s})}),Se=({isOpen:n,title:s,onCancel:t,onConfirm:a})=>e.jsx(Ne,{isOpen:n,children:e.jsxs("div",{className:"confirm-modal",children:[e.jsx("div",{className:"confirm-modal__content",children:e.jsx("h3",{className:"confirm-modal__title",children:s})}),e.jsxs("div",{className:"confirm-modal__footer",children:[e.jsx(v,{title:"Bekor qilish",className:"confirm-modal__btn",variant:"white",onClick:t,block:!0}),e.jsx("div",{className:"confirm-modal__line"}),e.jsx(v,{title:"O'chirish",className:"confirm-modal__btn",variant:"white",onClick:a,block:!0})]})]})}),ke="Left",Oe="Right",we="Up",ye="Down",_={delta:10,preventScrollOnSwipe:!1,rotationAngle:0,trackMouse:!1,trackTouch:!0,swipeDuration:1/0,touchEventOptions:{passive:!0}},D={first:!0,initial:[0,0],start:0,swiping:!1,xy:[0,0]},A="mousemove",L="mouseup",Ce="touchend",Te="touchmove",Ee="touchstart";function Me(n,s,t,a){return n>s?t>0?Oe:ke:a>0?ye:we}function P(n,s){if(s===0)return n;const t=Math.PI/180*s,a=n[0]*Math.cos(t)+n[1]*Math.sin(t),l=n[1]*Math.cos(t)-n[0]*Math.sin(t);return[a,l]}function De(n,s){const t=i=>{const c="touches"in i;c&&i.touches.length>1||n((o,m)=>{m.trackMouse&&!c&&(document.addEventListener(A,a),document.addEventListener(L,u));const{clientX:h,clientY:f}=c?i.touches[0]:i,x=P([h,f],m.rotationAngle);return m.onTouchStartOrOnMouseDown&&m.onTouchStartOrOnMouseDown({event:i}),Object.assign(Object.assign(Object.assign({},o),D),{initial:x.slice(),xy:x,start:i.timeStamp||0})})},a=i=>{n((c,o)=>{const m="touches"in i;if(m&&i.touches.length>1)return c;if(i.timeStamp-c.start>o.swipeDuration)return c.swiping?Object.assign(Object.assign({},c),{swiping:!1}):c;const{clientX:h,clientY:f}=m?i.touches[0]:i,[x,C]=P([h,f],o.rotationAngle),S=x-c.xy[0],k=C-c.xy[1],p=Math.abs(S),b=Math.abs(k),T=(i.timeStamp||0)-c.start,K=Math.sqrt(p*p+b*b)/(T||1),J=[S/(T||1),k/(T||1)],E=Me(p,b,S,k),F=typeof o.delta=="number"?o.delta:o.delta[E.toLowerCase()]||_.delta;if(p<F&&b<F&&!c.swiping)return c;const O={absX:p,absY:b,deltaX:S,deltaY:k,dir:E,event:i,first:c.first,initial:c.initial,velocity:K,vxvy:J};O.first&&o.onSwipeStart&&o.onSwipeStart(O),o.onSwiping&&o.onSwiping(O);let U=!1;return(o.onSwiping||o.onSwiped||o[`onSwiped${E}`])&&(U=!0),U&&o.preventScrollOnSwipe&&o.trackTouch&&i.cancelable&&i.preventDefault(),Object.assign(Object.assign({},c),{first:!1,eventData:O,swiping:!0})})},l=i=>{n((c,o)=>{let m;if(c.swiping&&c.eventData){if(i.timeStamp-c.start<o.swipeDuration){m=Object.assign(Object.assign({},c.eventData),{event:i}),o.onSwiped&&o.onSwiped(m);const h=o[`onSwiped${m.dir}`];h&&h(m)}}else o.onTap&&o.onTap({event:i});return o.onTouchEndOrOnMouseUp&&o.onTouchEndOrOnMouseUp({event:i}),Object.assign(Object.assign(Object.assign({},c),D),{eventData:m})})},r=()=>{document.removeEventListener(A,a),document.removeEventListener(L,u)},u=i=>{r(),l(i)},N=(i,c)=>{let o=()=>{};if(i&&i.addEventListener){const m=Object.assign(Object.assign({},_.touchEventOptions),c.touchEventOptions),h=[[Ee,t,m],[Te,a,Object.assign(Object.assign({},m),c.preventScrollOnSwipe?{passive:!1}:{})],[Ce,l,m]];h.forEach(([f,x,C])=>i.addEventListener(f,x,C)),o=()=>h.forEach(([f,x])=>i.removeEventListener(f,x))}return o},q={ref:i=>{i!==null&&n((c,o)=>{if(c.el===i)return c;const m={};return c.el&&c.el!==i&&c.cleanUpTouch&&(c.cleanUpTouch(),m.cleanUpTouch=void 0),o.trackTouch&&i&&(m.cleanUpTouch=N(i,o)),Object.assign(Object.assign(Object.assign({},c),{el:i}),m)})}};return s.trackMouse&&(q.onMouseDown=t),[q,N]}function Ie(n,s,t,a){return!s.trackTouch||!n.el?(n.cleanUpTouch&&n.cleanUpTouch(),Object.assign(Object.assign({},n),{cleanUpTouch:void 0})):n.cleanUpTouch?s.preventScrollOnSwipe!==t.preventScrollOnSwipe||s.touchEventOptions.passive!==t.touchEventOptions.passive?(n.cleanUpTouch(),Object.assign(Object.assign({},n),{cleanUpTouch:a(n.el,s)})):n:Object.assign(Object.assign({},n),{cleanUpTouch:a(n.el,s)})}function Re(n){const{trackMouse:s}=n,t=j.useRef(Object.assign({},D)),a=j.useRef(Object.assign({},_)),l=j.useRef(Object.assign({},a.current));l.current=Object.assign({},a.current),a.current=Object.assign(Object.assign({},_),n);let r;for(r in _)a.current[r]===void 0&&(a.current[r]=_[r]);const[u,N]=j.useMemo(()=>De(R=>t.current=R(t.current,a.current),{trackMouse:s}),[s]);return t.current=Ie(t.current,a.current,l.current,N),u}const qe=({item:n,onDelete:s,onEdit:t})=>{const[a,l]=j.useState(!1),r=Re({onSwipedLeft:()=>l(!0),onSwipedRight:()=>l(!1),trackMouse:!0});return e.jsxs("div",{className:y("comment__item",a&&"swiped"),...r,children:[e.jsxs("div",{className:"comment__item-content",children:[e.jsx("img",{className:"comment__item-image",src:n.user.profilePhotoUrl,alt:n.user.fullName,width:40,height:40}),e.jsxs("div",{className:"comment__item-info",children:[e.jsxs("div",{className:"comment__item-top",children:[e.jsx("strong",{className:"comment__item-name",children:n.user.fullName}),e.jsx("span",{className:"comment__item-time",children:n.createdTime})]}),e.jsx("p",{className:"comment__item-text",children:n.text})]})]}),e.jsxs("div",{className:y("comment__item-btns",a&&"visible"),children:[e.jsx(v,{className:"comment__item-btn",variant:"red",prefixIcon:e.jsx(d,{name:"Delete"}),onClick:s}),e.jsx(v,{className:"comment__item-btn",variant:"blue",prefixIcon:e.jsx(d,{name:"Edit"}),onClick:t})]})]})},Fe=()=>{const n=H(),[s,t]=j.useState(null),{items:a,isFetched:l}=pe({placeId:203675}),r=be();return e.jsxs("div",{className:"comment",children:[e.jsx(g,{text:"Reyting"}),e.jsxs("div",{className:"comment__card",children:[e.jsx("strong",{className:"comment__rating",children:"4.2"}),e.jsxs("div",{children:[e.jsx(ce,{rating:4}),e.jsx("span",{className:"comment__count",children:"32 marta baholangan"})]})]}),e.jsx(g,{text:"Sharh qoldirish"}),e.jsx("div",{className:"comment__card",children:e.jsx(v,{title:"Sharh yozish",variant:"light-blue",prefixIcon:e.jsx(d,{name:"Send",size:20}),onClick:()=>n("/comment-create"),block:!0})}),l?a.length?e.jsxs(e.Fragment,{children:[e.jsx(g,{text:"Sharhlar"}),e.jsx("div",{className:"comment__items",children:a.map(u=>e.jsx(qe,{item:u,onDelete:()=>{t(u.id)},onEdit:()=>{console.log("onEdit")}},u.id))})]}):e.jsx(I,{icon:"NoComment",description:"Hozircha sharhlar yo'q"}):e.jsx($,{color:"#007AFF"}),e.jsx(Se,{isOpen:!!s,title:"Sharhni o’chirishni xohlaysizmi?",onCancel:()=>{t(null)},onConfirm:()=>r.mutate({id:s},{onSuccess:()=>{t(null)}})})]})},Ue=()=>e.jsx("div",{className:"discount",children:e.jsx(I,{icon:"NoDiscount",description:"Aksiyalar mavjud emas"})}),ze=()=>{const[n,s]=j.useState("GENERAL"),{item:t,isFetched:a}=ge({id:se.app.placeId}),l={GENERAL:"Umimiy",COMMENT:"Sharhlar",IMAGES:"Rasmlar",DISCOUNT:"Aksiyalar"},r={GENERAL:e.jsx(ve,{}),COMMENT:e.jsx(Fe,{}),IMAGES:e.jsx(_e,{}),DISCOUNT:e.jsx(Ue,{})};return a?e.jsxs("div",{className:"place",children:[e.jsxs("div",{className:"place__head",children:[e.jsx("img",{src:t.image,alt:t.name,width:"100%",height:260}),e.jsx("div",{className:"place__head-discount",children:"-20% gacha chegirma"}),e.jsxs("div",{className:"place__head-time",children:[Math.floor(M.duration(M(t.workEndTime,"HH:mm").diff(M(t.workStartTime,"HH:mm"))).asHours()||0)," ","soat ochiq"]}),e.jsxs("div",{className:"place__head-icons",children:[e.jsx("div",{className:"place__head-icon",children:e.jsx(d,{name:"Heart",color:"#fff",size:24})}),e.jsx("div",{className:"place__head-icon",children:e.jsx(d,{name:"Share",color:"#fff",size:24})})]})]}),e.jsxs("div",{className:"place__body",children:[e.jsxs(ue,{children:[e.jsx(re,{size:32}),e.jsx(v,{title:"Joy buyurtma qilish",block:!0})]}),e.jsx("ul",{className:"place__tabs",children:Object.keys(l).map(u=>e.jsx("li",{className:y("place__tab",n===u&&"active"),onClick:()=>s(u),children:l[u]},u))}),r[n]]})]}):e.jsx("div",{className:"place__spinner",children:e.jsx($,{})})},Be=ze;export{Be as default};
