import{a as y,j as e,c as v,I as p,b as h,S as C}from"./index-CMoc7ZR7.js";import{F as S,a as w,g as _,S as I,u as k,b as z,L as x,T as R}from"./Label-CrhP1HJv.js";import{u as q,S as j}from"./Spacer-DbnJw1gm.js";import{E as D,C as E,g as $,u as F}from"./constants-B5zRJSNm.js";import{u as T,R as B}from"./Rating-CJdtJZGK.js";import{B as V}from"./Button-Jr4WYPXk.js";const Y=({onSuccess:s,onError:a,onSettled:i,children:t})=>{const l=y(),n=q(async r=>{const{data:c}=await E({values:r});return $(c)},{onSuccess:r=>{l.invalidateQueries({predicate:c=>c.queryKey[0]===D&&c.queryKey[1]==="list"}),s&&s(r)},onError:a,onSettled:i}),o=(r,{setSubmitting:c})=>{n.mutate(r,{onSettled:()=>c(!1)})};return e.jsx(S,{onSubmit:o,initialValues:{placeId:null,userId:null,star:0,text:""},enableReinitialize:!0,children:r=>e.jsx(w,{children:t(r)})})},A="FILE",L=({id:s})=>{const a={item:_()},{data:i=a,...t}=F([A,"single",s],async()=>{const{data:l}=await I({id:s});return{item:_(l&&l.data)}},{initialData:a,enabled:!!s});return{...t,...i}},P=({type:s,source:a,onRemove:i})=>e.jsxs("div",{className:"c-uploader__preview",children:[e.jsx("div",{className:"c-uploader__preview-image",children:s==="image"?e.jsx("img",{src:a,alt:"General preview"}):e.jsx("div",{className:v("file-type",`file-type--${s}`)})}),e.jsxs("div",{className:"c-uploader__preview-btns",children:[e.jsx("a",{className:"c-uploader__preview-btn",href:a,children:e.jsx(p,{name:"DownloadArrow",size:20})}),e.jsx("div",{className:"c-uploader__preview-btn",onClick:()=>i(),children:e.jsx(p,{name:"Delete",size:20})})]})]}),Q=({type:s,percent:a,total:i,loaded:t,onCancel:l})=>{const n={image:"Rasm yuklanayabdi",video:"Video yuklanayabdi",file:"Fayl yuklanayabdi"};return e.jsxs("div",{className:"c-uploader__progress",children:[e.jsxs("div",{className:"c-uploader__progress-header",children:[e.jsx("div",{className:"c-uploader__progress-title",children:n[s]}),e.jsxs("div",{className:"c-uploader__progress-percent",children:[a,"%"]}),e.jsx("div",{className:"c-uploader__progress-cancel",onClick:()=>l(),children:e.jsx(p,{name:"DismissCircle"})})]}),e.jsx("div",{className:"c-uploader__progress-bar",children:e.jsx("div",{className:"c-uploader__progress-bar-inner",style:{width:`${a}%`}})}),e.jsxs("div",{className:"c-uploader__progress-info",children:["Yuklangan: ",t," kb dan ",i," kb"]})]})},U=({accept:s,type:a,onSelect:i})=>{const t={image:"PhotoGroup",video:"VideoAdd",file:"DocumentAdd"};return e.jsxs("label",{className:"c-uploader__upload",children:[e.jsx("div",{className:"c-uploader__upload-icon",children:e.jsx(p,{name:t[a]})}),e.jsx("div",{className:"c-uploader__upload-text",children:"Rasm qo’shish"}),e.jsx("div",{className:"c-uploader__upload-btn",children:e.jsx("input",{type:"file",multiple:!1,accept:s&&s.join(","),onChange:({target:{files:l}})=>{const n=l&&l[0];n&&i(n)}})})]})},G=({state:s="default",accept:a,type:i,onSelect:t,file:l,progress:n,message:o})=>{let r;return s==="progress"&&n?r=e.jsx(Q,{type:i,...n}):s==="preview"&&l?r=e.jsx(P,{type:i,...l}):r=e.jsx(U,{accept:a,type:i,onSelect:t}),e.jsxs("div",{className:v("c-uploader",s&&`state-${s}`),children:[e.jsx("div",{className:"c-uploader__content",children:r}),!!o&&e.jsx("div",{className:"message",children:o})]})},K=({name:s,type:a,accept:i,maxFileSize:t,validation:l})=>{const[n,o,r]=k({name:s,validate:m=>l&&l.required&&!m?"Majburiy maydon":""}),{progress:c,...g}=z(),{item:d}=L({id:n.value}),f=m=>{if(t&&m.size>t*1e3){r.setError("Hajmi katta");return}r.setError(void 0),g.mutate({type:a,file:m,placeId:h.app.placeId,userId:h.app.userId},{onSuccess:b=>{r.setValue(b.id)}})};let u;const N={idle:"idle",loading:"progress",error:"error",success:"success"};return n.value&&d.id?u="preview":o.error?u="error":n.value&&!d.id?u="progress":u=N[g.status],e.jsx(G,{state:u,type:a,accept:i,onSelect:f,progress:{percent:c.percent,total:c.total,loaded:c.loaded,onCancel:()=>r.setValue(null)},file:{name:d.name,source:d.url,size:d.size,extension:d.extension,onRemove:()=>r.setValue(null)},message:o.error})},M=()=>{const s=T(a=>a.place.item);return e.jsx("div",{className:"comment-create",children:e.jsx(Y,{onSuccess:()=>{console.log("Comment successfully created!")},children:({isSubmitting:a,values:i,setFieldValue:t,handleSubmit:l})=>e.jsxs(e.Fragment,{children:[a&&e.jsx(C,{full:!0}),e.jsx(x,{title:"Baholash",children:e.jsxs("div",{className:"comment-create__rating",children:[e.jsx(B,{rating:i.star,onClick:n=>{t("star",n)},size:40}),e.jsx("span",{className:"comment-create__rating-text",children:"Baholang"})]})}),e.jsx(j,{size:24}),e.jsx(x,{title:"Rasm qo’shish",children:e.jsx(K,{name:"image",type:"image",accept:["image/*"],maxFileSize:10240})}),e.jsx(j,{size:24}),e.jsx(x,{title:"Sharh qoldirish",children:e.jsx(R,{name:"text",validation:{required:!0}})}),e.jsx(j,{size:24}),e.jsx(V,{title:"Yuborish",onClick:()=>{t("userId",h.app.userId),t("placeId",s.id),l()},block:!0})]})})})},ee=M;export{ee as default};
