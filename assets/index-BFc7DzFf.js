import{R as y,r as x,h as V,g as U,s as Z,d as ee,j as e,I as d,e as H,u as B,f as ne,a as se,c as E,S as $,z as te,i as I,b as ae}from"./index-CZw6Rq0R.js";import{u as Y,L as ie,g as G,E as Q,D as ce}from"./constants-Co5xM6Lv.js";import{a as oe,u as X,R as re}from"./Rating-PPrhjrYG.js";import{B as b}from"./Button-VvUdTyHk.js";import{u as le,S as me}from"./Spacer-B8lAHV99.js";import{P as ue}from"./ProblemItem-DIvFp5nS.js";import{T as v,I as de,P as he}from"./PlaceCard-BPkgEduz.js";function K(n){n===void 0&&(n=y);var t=n===y?oe:function(){return x.useContext(n)};return function(){var a=t(),r=a.store;return r}}var je=K();function xe(n){n===void 0&&(n=y);var t=n===y?je:K(n);return function(){var a=t();return a.dispatch}}var fe=xe();const ge=({id:n})=>V.request.get(`/place/${n}`),ve="PLACE",_e=({id:n})=>{const t=fe(),s={item:U()},{data:a=s,...r}=Y([ve,"single",n],async()=>{const{data:m}=await ge({id:n});return{item:U(m)}},{initialData:s,enabled:!!n,onSuccess:m=>{t(Z(m.item))},onError:()=>{t(ee())}});return{...r,...a}},R=({icon:n,description:t})=>e.jsxs("div",{className:"c-empty",children:[e.jsx("div",{children:e.jsx(d,{name:n})}),e.jsx("p",{className:"c-empty__description",children:t})]}),pe=()=>{const{images:n}=X(t=>t.place.item);return e.jsx("div",{className:"image",children:n!=null&&n.length?e.jsx("div",{className:"image__list",children:n==null?void 0:n.map(t=>e.jsx("div",{className:"image__item",children:e.jsx("img",{src:t.image,alt:"",width:126,height:126})},t.id))}):e.jsx(R,{icon:"NoImage",description:"Hozircha rasmlar yo'q"})})},be=()=>{const n=H(),t=B(),s=X(r=>r.place.item),a=x.useMemo(()=>[{title:"Joy ma’lumotlari",items:[{icon:"Location",iconBgColor:"#007AFF",key:"Manzil",value:s.fullAddress,valueColor:"#8E8E93",onClick:()=>{}},{icon:"Car",iconBgColor:"#FF9500",key:"Manzilgacha Yandex-taxi",value:"4km • 15-20 min • 20,000 so’m",valueColor:"#8E8E93",onClick:()=>{}},{icon:"Phone",iconBgColor:"#007AFF",key:"Aloqa raqami",value:s.phone,valueColor:"#007AFF",onClick:()=>n.openLink(`tel:${s.phone}`)},{icon:"Phone",iconBgColor:"#007AFF",key:"Qo’shimcha aloqa raqami",value:s.phone2,valueColor:"#007AFF",onClick:()=>n.openLink(`tel:${s.phone2}`)},{icon:"Network",iconBgColor:"#34C759",key:"Web sayti",value:s.website,valueColor:"#007AFF",onClick:()=>n.openLink(s.website)}]},{title:"Ishlash vaqtlari va qulayliklar",items:[{icon:"Clock",iconBgColor:"#007AFF",key:"Ishlash vaqtlari",value:`Ochiq • ${s.workStartTime} - ${s.workEndTime}`,valueColor:"#8E8E93",onClick:()=>t("/place/work-times")},{icon:"PuzzlePiece",iconBgColor:"#FF9500",key:"Qulayliklar",value:"Wi-fi • Karta orqali to’lash • Halol",valueColor:"#8E8E93",onClick:()=>t("/place/amenities")}]}],[s]);return e.jsxs("div",{className:"general",children:[a.map((r,m)=>e.jsxs("div",{className:"general__item-group",children:[e.jsx(v,{text:r.title}),e.jsx("div",{className:"general__items",children:r.items.map(u=>e.jsx(de,{className:"general__item",left:e.jsx("div",{className:"general__item-icon",style:{backgroundColor:u.iconBgColor},children:e.jsx(d,{name:u.icon,color:"#ffffff",size:28})}),center:e.jsxs("div",{className:"general__item-info",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"general__item-key",children:u.key}),e.jsx("span",{className:"general__item-value",style:{color:u.valueColor},children:u.value})]}),e.jsx("div",{children:e.jsx(d,{name:"ChevronRight",color:"#7F7F7F",size:24})})]}),onClick:u.onClick},u.key))})]},m)),e.jsxs("div",{className:"general__item-group",children:[e.jsx(v,{text:"Ijtimoiy tarmoqlarga havola"}),e.jsxs("div",{className:"general__networks",children:[s.instagram&&e.jsx("a",{href:s.instagram,target:"_blank",rel:"noreferrer",children:e.jsx(d,{name:"Instagram",size:48})}),s.twitter&&e.jsx("a",{href:s.twitter,target:"_blank",rel:"noreferrer",children:e.jsx(d,{name:"Twitter",size:48})}),s.youtube&&e.jsx("a",{href:s.youtube,target:"_blank",rel:"noreferrer",children:e.jsx(d,{name:"Youtube",size:48})}),s.telegram&&e.jsx("a",{href:s.telegram,target:"_blank",rel:"noreferrer",children:e.jsx(d,{name:"Telegram",size:48})}),s.facebook&&e.jsx("a",{href:s.facebook,target:"_blank",rel:"noreferrer",children:e.jsx(d,{name:"Facebook",size:48})})]})]}),e.jsxs("div",{className:"general__item-group",children:[e.jsx(v,{text:"Joy xaqida"}),e.jsx("div",{className:"general__info",children:e.jsx("p",{className:"general__info-text",dangerouslySetInnerHTML:{__html:s.info}})})]}),e.jsxs("div",{className:"general__item-group",children:[e.jsx(v,{text:"Biz bilan aloqa"}),e.jsx(ue,{})]})]})},Ne=({placeId:n})=>{const t={items:[]},{data:s=t,...a}=Y([Q,"list",n],async()=>{const{data:r}=await ie({placeId:n});return{items:(ne(r,"results")||[]).map(G)}},{initialData:t,keepPreviousData:!0,enabled:!!n});return{...s,...a}},Se=()=>{const n=se();return le(async({id:t})=>{const{data:s}=await ce({id:t});return G(s)},{onSuccess:()=>{n.invalidateQueries({predicate:t=>t.queryKey[0]===Q&&t.queryKey[1]==="list"})}})},ke=({isOpen:n,children:t})=>e.jsx("div",{className:E("c-modal",n&&"open"),children:e.jsx("div",{className:"c-modal__content",children:!!t&&t})}),Oe=({isOpen:n,title:t,onCancel:s,onConfirm:a})=>e.jsx(ke,{isOpen:n,children:e.jsxs("div",{className:"confirm-modal",children:[e.jsx("div",{className:"confirm-modal__content",children:e.jsx("h3",{className:"confirm-modal__title",children:t})}),e.jsxs("div",{className:"confirm-modal__footer",children:[e.jsx(b,{title:"Bekor qilish",className:"confirm-modal__btn",variant:"white",onClick:s,block:!0}),e.jsx("div",{className:"confirm-modal__line"}),e.jsx(b,{title:"O'chirish",className:"confirm-modal__btn",variant:"white",onClick:a,block:!0})]})]})}),we="Left",Ce="Right",ye="Up",Ee="Down",p={delta:10,preventScrollOnSwipe:!1,rotationAngle:0,trackMouse:!1,trackTouch:!0,swipeDuration:1/0,touchEventOptions:{passive:!0}},F={first:!0,initial:[0,0],start:0,swiping:!1,xy:[0,0]},q="mousemove",z="mouseup",Te="touchend",Me="touchmove",De="touchstart";function Ie(n,t,s,a){return n>t?s>0?Ce:we:a>0?Ee:ye}function P(n,t){if(t===0)return n;const s=Math.PI/180*t,a=n[0]*Math.cos(s)+n[1]*Math.sin(s),r=n[1]*Math.cos(s)-n[0]*Math.sin(s);return[a,r]}function Fe(n,t){const s=i=>{const c="touches"in i;c&&i.touches.length>1||n((o,l)=>{l.trackMouse&&!c&&(document.addEventListener(q,a),document.addEventListener(z,u));const{clientX:j,clientY:g}=c?i.touches[0]:i,f=P([j,g],l.rotationAngle);return l.onTouchStartOrOnMouseDown&&l.onTouchStartOrOnMouseDown({event:i}),Object.assign(Object.assign(Object.assign({},o),F),{initial:f.slice(),xy:f,start:i.timeStamp||0})})},a=i=>{n((c,o)=>{const l="touches"in i;if(l&&i.touches.length>1)return c;if(i.timeStamp-c.start>o.swipeDuration)return c.swiping?Object.assign(Object.assign({},c),{swiping:!1}):c;const{clientX:j,clientY:g}=l?i.touches[0]:i,[f,T]=P([j,g],o.rotationAngle),O=f-c.xy[0],w=T-c.xy[1],S=Math.abs(O),k=Math.abs(w),M=(i.timeStamp||0)-c.start,J=Math.sqrt(S*S+k*k)/(M||1),W=[O/(M||1),w/(M||1)],D=Ie(S,k,O,w),L=typeof o.delta=="number"?o.delta:o.delta[D.toLowerCase()]||p.delta;if(S<L&&k<L&&!c.swiping)return c;const C={absX:S,absY:k,deltaX:O,deltaY:w,dir:D,event:i,first:c.first,initial:c.initial,velocity:J,vxvy:W};C.first&&o.onSwipeStart&&o.onSwipeStart(C),o.onSwiping&&o.onSwiping(C);let A=!1;return(o.onSwiping||o.onSwiped||o[`onSwiped${D}`])&&(A=!0),A&&o.preventScrollOnSwipe&&o.trackTouch&&i.cancelable&&i.preventDefault(),Object.assign(Object.assign({},c),{first:!1,eventData:C,swiping:!0})})},r=i=>{n((c,o)=>{let l;if(c.swiping&&c.eventData){if(i.timeStamp-c.start<o.swipeDuration){l=Object.assign(Object.assign({},c.eventData),{event:i}),o.onSwiped&&o.onSwiped(l);const j=o[`onSwiped${l.dir}`];j&&j(l)}}else o.onTap&&o.onTap({event:i});return o.onTouchEndOrOnMouseUp&&o.onTouchEndOrOnMouseUp({event:i}),Object.assign(Object.assign(Object.assign({},c),F),{eventData:l})})},m=()=>{document.removeEventListener(q,a),document.removeEventListener(z,u)},u=i=>{m(),r(i)},_=(i,c)=>{let o=()=>{};if(i&&i.addEventListener){const l=Object.assign(Object.assign({},p.touchEventOptions),c.touchEventOptions),j=[[De,s,l],[Me,a,Object.assign(Object.assign({},l),c.preventScrollOnSwipe?{passive:!1}:{})],[Te,r,l]];j.forEach(([g,f,T])=>i.addEventListener(g,f,T)),o=()=>j.forEach(([g,f])=>i.removeEventListener(g,f))}return o},N={ref:i=>{i!==null&&n((c,o)=>{if(c.el===i)return c;const l={};return c.el&&c.el!==i&&c.cleanUpTouch&&(c.cleanUpTouch(),l.cleanUpTouch=void 0),o.trackTouch&&i&&(l.cleanUpTouch=_(i,o)),Object.assign(Object.assign(Object.assign({},c),{el:i}),l)})}};return t.trackMouse&&(N.onMouseDown=s),[N,_]}function Re(n,t,s,a){return!t.trackTouch||!n.el?(n.cleanUpTouch&&n.cleanUpTouch(),Object.assign(Object.assign({},n),{cleanUpTouch:void 0})):n.cleanUpTouch?t.preventScrollOnSwipe!==s.preventScrollOnSwipe||t.touchEventOptions.passive!==s.touchEventOptions.passive?(n.cleanUpTouch(),Object.assign(Object.assign({},n),{cleanUpTouch:a(n.el,t)})):n:Object.assign(Object.assign({},n),{cleanUpTouch:a(n.el,t)})}function Le(n){const{trackMouse:t}=n,s=x.useRef(Object.assign({},F)),a=x.useRef(Object.assign({},p)),r=x.useRef(Object.assign({},a.current));r.current=Object.assign({},a.current),a.current=Object.assign(Object.assign({},p),n);let m;for(m in p)a.current[m]===void 0&&(a.current[m]=p[m]);const[u,_]=x.useMemo(()=>Fe(h=>s.current=h(s.current,a.current),{trackMouse:t}),[t]);return s.current=Re(s.current,a.current,r.current,_),u}const Ae=({item:n,onDelete:t,onEdit:s})=>{const[a,r]=x.useState(!1),m=Le({onSwipedLeft:()=>r(!0),onSwipedRight:()=>r(!1),trackMouse:!0});return e.jsxs("div",{className:E("comment__item",a&&"swiped"),...m,children:[e.jsxs("div",{className:"comment__item-content",children:[e.jsx("img",{className:"comment__item-image",src:n.user.profilePhotoUrl,alt:n.user.fullName,width:40,height:40}),e.jsxs("div",{className:"comment__item-info",children:[e.jsxs("div",{className:"comment__item-top",children:[e.jsx("strong",{className:"comment__item-name",children:n.user.fullName}),e.jsx("span",{className:"comment__item-time",children:n.createdTime})]}),e.jsx("p",{className:"comment__item-text",children:n.text})]})]}),e.jsxs("div",{className:E("comment__item-btns",a&&"visible"),children:[e.jsx(b,{className:"comment__item-btn",variant:"red",prefixIcon:e.jsx(d,{name:"Delete"}),onClick:t}),e.jsx(b,{className:"comment__item-btn",variant:"blue",prefixIcon:e.jsx(d,{name:"Edit"}),onClick:s})]})]})},Ue=()=>{const n=B(),[t,s]=x.useState(null),{items:a,isFetched:r}=Ne({placeId:203675}),m=Se();return e.jsxs("div",{className:"comment",children:[e.jsx(v,{text:"Reyting"}),e.jsxs("div",{className:"comment__card",children:[e.jsx("strong",{className:"comment__rating",children:"4.2"}),e.jsxs("div",{children:[e.jsx(re,{rating:4}),e.jsx("span",{className:"comment__count",children:"32 marta baholangan"})]})]}),e.jsx(v,{text:"Sharh qoldirish"}),e.jsx("div",{className:"comment__card",children:e.jsx(b,{title:"Sharh yozish",variant:"light-blue",prefixIcon:e.jsx(d,{name:"Send",size:20}),onClick:()=>n("/comment-create"),block:!0})}),r?a.length?e.jsxs(e.Fragment,{children:[e.jsx(v,{text:"Sharhlar"}),e.jsx("div",{className:"comment__items",children:a.map(u=>e.jsx(Ae,{item:u,onDelete:()=>{s(u.id)},onEdit:()=>{console.log("onEdit")}},u.id))})]}):e.jsx(R,{icon:"NoComment",description:"Hozircha sharhlar yo'q"}):e.jsx($,{color:"#007AFF"}),e.jsx(Oe,{isOpen:!!t,title:"Sharhni o’chirishni xohlaysizmi?",onCancel:()=>{s(null)},onConfirm:()=>m.mutate({id:t},{onSuccess:()=>{s(null)}})})]})},qe=()=>e.jsx("div",{className:"discount",children:e.jsx(R,{icon:"NoDiscount",description:"Aksiyalar mavjud emas"})}),ze=()=>{const n=H(),t=te(),[s,a]=x.useState("GENERAL"),{item:r,isFetched:m}=_e({id:ae.app.placeId}),u={GENERAL:"Umimiy",COMMENT:"Sharhlar",IMAGES:"Rasmlar",DISCOUNT:"Aksiyalar"},_={GENERAL:e.jsx(be,{}),COMMENT:e.jsx(Ue,{}),IMAGES:e.jsx(pe,{}),DISCOUNT:e.jsx(qe,{})};return m?e.jsxs("div",{className:"place",children:[e.jsxs("div",{className:"place__head",children:[e.jsx("img",{src:r.image,alt:r.name,width:"100%",height:260}),e.jsx("div",{className:"place__head-discount",children:"-20% gacha chegirma"}),e.jsxs("div",{className:"place__head-time",children:[Math.floor(I.duration(I(r.workEndTime,"HH:mm").diff(I(r.workStartTime,"HH:mm"))).asHours()||0)," ","soat ochiq"]}),e.jsxs("div",{className:"place__head-icons",children:[e.jsx("div",{className:"place__head-icon",children:e.jsx(d,{name:"Heart",color:"#ffffff",size:24})}),e.jsx("div",{className:"place__head-icon",onClick:()=>{var N;const h=(N=t==null?void 0:t.user)==null?void 0:N.username;h&&n.shareURL(h)},children:e.jsx(d,{name:"Share",color:"#ffffff",size:24})})]})]}),e.jsxs("div",{className:"place__body",children:[e.jsxs(he,{children:[e.jsx(me,{size:32}),e.jsx(b,{title:"Joy buyurtma qilish",block:!0})]}),e.jsx("ul",{className:"place__tabs",children:Object.keys(u).map(h=>e.jsx("li",{className:E("place__tab",s===h&&"active"),onClick:()=>a(h),children:u[h]},h))}),_[s]]})]}):e.jsx("div",{className:"place__spinner",children:e.jsx($,{})})},Xe=ze;export{Xe as default};
